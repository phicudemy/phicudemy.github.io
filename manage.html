---
title: مدیریت
slug: manage
layout: default
permalink: /manage/
---

<div id="user-table-container" class="container mt-4">
  <h2>مدیریت کاربران</h2>
  <div id="user-table">در حال بارگذاری کاربران...</div>
</div>

<script>
async function fetchAllUsers() {
  const token = (await client.auth.getSession()).data.session.access_token;

  const response = await fetch('https://iptradvpkatbfgibcrru.supabase.co/functions/v1/list_users', {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${token}`
    }
  });

  const result = await response.json();
  if (result.error) {
    document.getElementById("user-table").innerHTML = `<p class="text-danger">${result.error}</p>`;
  } else {
    renderUserTable(result.users);
  }
}

function renderUserTable(users) {
  let html = `<table class="table table-bordered"><thead><tr>
    <th>ایمیل</th><th>نام</th><th>تلفن</th><th>نقش</th><th>عملیات</th>
  </tr></thead><tbody>`;

  users.forEach(user => {
    html += `<tr>
      <td>${user.email}</td>
      <td>${user.user_metadata?.full_name || '-'}</td>
      <td>${user.user_metadata?.phone || '-'}</td>
      <td>${user.user_metadata?.role || '-'}</td>
      <td>
        <button class="btn btn-sm btn-primary" onclick="editRole('${user.id}')">تغییر نقش</button>
        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')">حذف</button>
      </td>
    </tr>`;
  });

  html += '</tbody></table>';
  document.getElementById("user-table").innerHTML = html;
}

fetchAllUsers();
</script>
